
      const totalGroups = Math.ceil(trechos.length / groupSize);
      if (currentGroupIndex < totalGroups - 1) { currentGroupIndex++; atualizarTela(); }
    }
    function voltar() {
      if (currentGroupIndex > 0) { currentGroupIndex--; atualizarTela(); }
    }
    avancarBtn.onclick = avancar;
    voltarBtn.onclick = voltar;

    // === Reconhecimento de Voz ===
    function initVoiceRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        voiceIndicator.textContent = "Voz n√£o suportada";
        voiceBtn.disabled = true;
        return;
      }
      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = "pt-BR";

      recognition.onstart = () => {
        voiceIndicator.textContent = "Escutando...";
        voiceIndicator.classList.add("listening");
      };

      recognition.onresult = (event) => {
        let transcript = "";
        for (let i = event.resultIndex; i < event.results.length; i++) {
          transcript += event.results[i][0].transcript + " ";
        }
        transcript = transcript.toLowerCase().trim();
        voiceIndicator.textContent = "Ouvindo: " + transcript;
        // Processar mesmo antes de ser final para resposta mais r√°pida
        if (event.results[event.results.length - 1].isFinal) {
          processVoiceCommand(transcript);
        } else if (transcript.length > 3) {
          // Verificar tamb√©m em resultados intermedi√°rios para resposta mais r√°pida
          processVoiceCommandFast(transcript);
        }
      };

      recognition.onerror = (e) => {
        voiceIndicator.textContent = "Erro: " + e.error;
      };

      recognition.onend = () => {
        voiceIndicator.classList.remove("listening");
        if (voiceBtn.dataset.active === "true") {
          setTimeout(() => recognition.start(), 50);
        }
      };
    }

    // === Processar Comando de Voz (R√°pido) ===
    function processVoiceCommandFast(transcript) {
      if (trechos.length === 0) return;
      
      const grupoAtual = getCurrentGroup();
      const textoAtual = grupoAtual.join(' ').toLowerCase();
      const ultimasPalavras = getLastNWords(textoAtual, 4);
      
      if (ultimasPalavras && matchWords(transcript, ultimasPalavras)) {
        console.log('‚úì Avan√ßando R√ÅPIDO por √∫ltimas 4 palavras');
        voiceIndicator.textContent = '‚úì Avan√ßando... (' + ultimasPalavras + ')';
        recognition.stop();
        avancar();
        return;
      }
      
      const totalGroups = Math.ceil(trechos.length / groupSize);
      if (currentGroupIndex < totalGroups - 1) {
        const proximoGrupo = trechos.slice((currentGroupIndex + 1) * groupSize, (currentGroupIndex + 1) * groupSize + groupSize);
        const textoProximo = proximoGrupo.join(' ').toLowerCase();
        const primeirasProximas = getFirstNWords(textoProximo, 4);
        
        if (primeirasProximas && matchWords(transcript, primeirasProximas)) {
          console.log('‚úì Avan√ßando R√ÅPIDO por primeiras 4 do pr√≥ximo');
          voiceIndicator.textContent = '‚úì Avan√ßando... (' + primeirasProximas + ')';
          recognition.stop();
          avancar();
          return;
        }
      }
    }

    // === Processar Comando de Voz ===
    function processVoiceCommand(transcript) {
      if (trechos.length === 0) return;
      
      // Obter o grupo atual
      const grupoAtual = getCurrentGroup();
      const textoAtual = grupoAtual.join(' ').toLowerCase();
      
      // Obter as √∫ltimas 4 palavras do grupo atual
      const ultimasPalavras = getLastNWords(textoAtual, 4);
      console.log('Falado:', transcript);
      console.log('√öltimas 4 palavras:', ultimasPalavras);
      
      // Verificar se as √∫ltimas 4 palavras foram faladas
      if (ultimasPalavras && matchWords(transcript, ultimasPalavras)) {
        console.log('‚úì Avan√ßando por √∫ltimas 4 palavras');
        voiceIndicator.textContent = '‚úì Avan√ßando... (' + ultimasPalavras + ')';
        avancar();
        return;
      }
      
      // Verificar as primeiras 4 palavras do pr√≥ximo grupo
      const totalGroups = Math.ceil(trechos.length / groupSize);
      if (currentGroupIndex < totalGroups - 1) {
        const proximoGrupo = trechos.slice((currentGroupIndex + 1) * groupSize, (currentGroupIndex + 1) * groupSize + groupSize);
        const textoProximo = proximoGrupo.join(' ').toLowerCase();
        const primeirasProximas = getFirstNWords(textoProximo, 4);
        console.log('Primeiras 4 do pr√≥ximo:', primeirasProximas);
        
        if (primeirasProximas && matchWords(transcript, primeirasProximas)) {
          console.log('‚úì Avan√ßando por primeiras 4 do pr√≥ximo');
          voiceIndicator.textContent = '‚úì Avan√ßando... (' + primeirasProximas + ')';
          avancar();
          return;
        }
      }
    }
    
    function getLastNWords(text, n) {
      const words = text.trim().split(/\s+/).filter(w => w.length > 0);
      return words.slice(-n).join(' ');
    }
    
    function getFirstNWords(text, n) {
      const words = text.trim().split(/\s+/).filter(w => w.length > 0);
      return words.slice(0, n).join(' ');
    }
    
    function matchWords(transcript, target) {
      // Remover pontua√ß√£o
      const cleanTranscript = transcript.replace(/[.,!?;:\-]/g, '').trim();
      const cleanTarget = target.replace(/[.,!?;:\-]/g, '').trim();
      
      // Verifica√ß√£o exata
      if (cleanTranscript.includes(cleanTarget)) {
        return true;
      }
      
      // Verifica√ß√£o parcial (pelo menos 3 das 4 palavras)
      const tWords = cleanTranscript.split(/\s+/);
      const targetWords = cleanTarget.split(/\s+/);
      
      let matches = 0;
      for (let i = 0; i < targetWords.length; i++) {
        for (let j = 0; j < tWords.length; j++) {
          if (tWords[j].includes(targetWords[i]) || targetWords[i].includes(tWords[j])) {
            matches++;
            break;
          }
        }
      }
      
      return matches >= 3;
    }

    voiceBtn.onclick = () => {
      if (!recognition) initVoiceRecognition();
      if (voiceBtn.dataset.active === "true") {
        recognition.stop();
        voiceBtn.dataset.active = "false";
        voiceBtn.textContent = "üé§ Iniciar Voz";
        voiceIndicator.textContent = "Microfone desligado";
      } else {
        recognition.start();
        voiceBtn.dataset.active = "true";
        voiceBtn.textContent = "üé§ Parar Voz";
        voiceIndicator.textContent = "Escutando...";
      }
    };

    // Navega√ß√£o por teclado
    document.addEventListener('keydown', (e) => {
      if (trechos.length === 0) return;
      if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); avancar(); }
      if (e.key === 'ArrowLeft') { e.preventDefault(); voltar(); }
    });

    console.log('‚úì Voice Presentation App iniciado');
  </script>
</body>
</html>
